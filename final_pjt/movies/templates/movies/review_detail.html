{% extends 'base.html' %}
{% load bootstrap_pagination %}
{% load bootstrap4 %}

{% block content %}
<div class="container text-white">
    <div class="text-center">
        <h1 class="py-3">게시글 상세보기</h1>
    </div>
    
    <span class="custom-br"></span>

    <div class="row">
        <div class="col-9">
            <p>제목 : {{ review.title }}</p>
            <p>작성자 : {{ review.user }}</p>
            내용 :<p>{{ review.content }}</p>
            {% if request.user in review.like_users.all %}
                <a class="btn btn-success" href="{% url 'movies:like' movie.pk review.pk %}" role="button">
                    좋아요 <span class="badge badge-light">{{ review.like_users.count }}</span>
                    <span class="sr-only">unread messages</span>
                </a>
            {% else %}
                <a class="btn btn-secondary" href="{% url 'movies:like' movie.pk review.pk %}" role="button">
                    좋아요 <span class="badge badge-light">{{ review.like_users.count }}</span>
                    <span class="sr-only">unread messages</span>
                </a>
            {% endif %}

            {% if request.user in review.hate_users.all %}
                <a class="btn btn-danger" href="{% url 'movies:hate' movie.pk review.pk %}" role="button">
                    싫어요 <span class="badge badge-light">{{ review.hate_users.count }}</span>
                    <span class="sr-only">unread messages</span>
                </a>
            {% else %}
                <a class="btn btn-secondary" href="{% url 'movies:hate' movie.pk review.pk %}" role="button">
                    싫어요 <span class="badge badge-light">{{ review.hate_users.count }}</span>
                    <span class="sr-only">unread messages</span>
                </a>
            {% endif %}

            <p class="text-right">평점 : </p>
            <p class="text-right">생성시각: {{ review.created_at }}</p>
            <p class="text-right">수정시각: {{ review.updated_at }}</p>
        </div>
        <div class="col-3">
            <img class="img-fluid" src="https://image.tmdb.org/t/p/original/{{ movie.poster_path }}" alt="movie-poster">
        </div>
    </div>

    <span class="custom-br"></span>

    <a  class="btn btn-secondary" href="{% url 'movies:detail' movie.pk %}" role="button">뒤로가기</a>
    {% if user.is_authenticated %}
    <a  class="btn btn-secondary" href="{% url 'movies:update' movie.pk review.pk %}" role="button">수정</a>
    {% else %}
    <p>수정은 로그인이 필요합니다.</p>
    {% endif %}
    <form action="{% url 'movies:delete' movie.pk review.pk %}" method="POST">
        {% csrf_token %}
        <button  class="btn btn-secondary" type="submit">삭제</button>
    </form>
    
    <span class="custom-br"></span>

    <h5>댓글목록 ({{ review.comment_set.all|length }}개의 댓글이 있습니다.)</h5>
    {% for comment in review.comment_set.all %}
    <p>[{{ comment.pk }}] {{ comment.content }}</p>
    <a href="{% url 'movies:comment_update' movie.pk review.pk comment.pk %}">수정하기</a>
    <form action="{% url 'movies:comment_delete' movie.pk review.pk comment.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="삭제">
    </form>
    {% empty %}
    <p>첫번째 댓글의 주인공이 되세요.</p>
    {% endfor %}
    <hr>
    {% if user.is_authenticated %}
    <form action="{% url 'movies:comment_create' movie.pk review.pk %}" method="POST">
        {% csrf_token %}
        {% bootstrap_form form %}
        <button>댓글작성</button>
    </form>
    {% else %}
    <p>댓글은 로그인이 필요합니다.</p>
    {% endif %}
</div>

<style>
.custom-br {
  display:block;
  width: 100%;
  height: 3px;
  background-color: white; /*change color*/
  margin-top: 10px;
  margin-bottom: 10px;
}
</style>
{% endblock %}